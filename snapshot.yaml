---
- name: Criar snapshot das instâncias selecionadas
  hosts: all
  collections:
    - openstack.cloud
  gather_facts: false
  tasks:
    - name: Criar snapshot da instância
      openstack.cloud.server_snapshot:
        name: "snapshot-{{ inventory_hostname }}-{{ lookup('pipe', 'date +%Y%m%d%H%M%S') }}"
        server: "{{ inventory_hostname }}"
        wait: yes
      delegate_to: localhost
